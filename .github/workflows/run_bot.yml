name: AutoTrader Notifier

on:
  schedule:
    - cron: "*/15 * * * *"
  workflow_dispatch:

permissions:
  contents: write   # ‚Üê allows the bot to commit back to the repo

jobs:
  watch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install deps (incl. Playwright)
        run: |
          pip install -r requirements.txt
          python -m playwright install --with-deps chromium
      - name: Run bot
        env: ${{ secrets }}   # exposes all repo secrets
        run: python autotrader_bot.py
      - name: Commit any updates
        run: |
          git config user.name  "autotrader-bot"
          git config user.email "actions@github.com"
          if ! git diff --quiet; then
            git add archives/** seen_listings.json
            git commit -m "Update seen listings and archives [skip ci]"
            git push
          fi
